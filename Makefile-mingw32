
DESTDIR=
PREFIX=C:
BINDIR=$(PREFIX)\bin
LIBDIR=$(PREFIX)\lib
INCLUDEDIR=$(PREFIX)\include
SYSCONFDIR=\etc

CC=gcc
CFLAGS=-march=native -mtune=native -O3

SUBDIRS=libdanh test quadequi datatypes

all: bin $(SUBDIRS)

.PHONY: $(SUBDIRS) clean install uninstall

bin:
	mkdir bin

libdanh:
	$(CC) $(CFLAGS) -c libdanh/danh.c
	$(CC) $(CFLAGS) -c libdanh/math.c
	$(CC) $(CFLAGS) -c libdanh/types.c
	$(CC) -shared -Wl,-soname,libdanh.dll danh.o math.o types.o -o bin/libdanh.dll

test:
	$(CC) $(CFLAGS) test/sqrt.c -o test/sqrt.exe -L./bin -ldanh

quadequi:
	$(CC) $(CFLAGS) quadequi/main.c -o bin/quadequi.exe -L./bin -ldanh

datatypes:
	$(CC) $(CFLAGS) datatypes/main.c -o bin/datatypes.exe

clean:
	del /Q *.o
	del /Q bin\*
	rmdir /Q bin
	del /Q test\*.exe
	

install:
	copy /Y bin\* $(DESTDIR)$(BINDIR)
	copy /Y libdanh.pc $(DESTDIR)$(LIBDIR)\pkgconfig\libdanh.pc
	copy /Y include\* $(DESTDIR)$(INCLUDEDIR)\libdanh


uninstall:
	del $(DESTDIR)$(BINDIR)\libdanh.dll
	del $(DESTDIR)$(LIBDIR)\pkgconfig\libdanh.pc
	del /Q $(DESTDIR)$(INCLUDEDIR)\libdanh
	del $(DESTDIR)$(BINDIR)\datatypes.exe
	del $(DESTDIR)$(BINDIR)\quadequi.exe
