
DESTDIR=
PREFIX=C:
BINDIR=$(PREFIX)\bin
LIBDIR=$(PREFIX)\lib
INCLUDEDIR=$(PREFIX)\include
SYSCONFDIR=\etc

CC=gcc
CFLAGS=-march=native -mtune=native -O3 -Wall
DEFS=

SUBDIRS=libdh quadequi datatypes portping win32

all: out $(SUBDIRS)

.PHONY: $(SUBDIRS) window win-name clean install uninstall

out:
	mkdir libout
	mkdir out
	mkdir bin


libdh:
	$(CC) $(CFLAGS) $(DEFS) -c libdh/dh.c -o libout/dh.o
	$(CC) $(CFLAGS) $(DEFS) -c libdh/math.c -o libout/math.o
	$(CC) $(CFLAGS) $(DEFS) -c libdh/types.c -o libout/types.o
	$(CC) $(CFLAGS) $(DEFS) -c libdh/misc.c -o libout/misc.o
	$(CC) -shared -Wl,-soname,libdh.dll libout/dh.o libout/math.o libout/types.o libout/misc.o -o bin/libdh.dll


quadequi:
	$(CC) $(CFLAGS) $(DEFS) quadequi/main.c -o bin/quadequi.exe -L./bin -ldh

datatypes:
	$(CC) $(CFLAGS) $(DEFS) datatypes/main.c -o bin/datatypes.exe -L./bin -ldh

portping:
	$(CC) $(CFLAGS) $(DEFS) portping/main.c -o bin/portping.exe -L./bin -ldh -lws2_32

win32: window win-name

window:
	windres -i win32\window\window.rc --input-format=rc -o out\window.res -O coff
	$(CC) $(CFLAGS) -D UNICODE -c win32/window/main.c -o out/window.o -Wall -lgdi32
	$(CC) out/window.res out/window.o -o bin/window.exe -lgdi32

win-name:
	$(CC) $(CFLAGS) -D UNICODE win32/win-name/main.c -o bin/win-name.exe -lgdi32



clean:
	del /Q libout\*
	del /Q out\*
	del /Q bin\*
	rmdir /Q libout
	rmdir /Q out
	rmdir /Q bin


install:
	copy /Y bin\* $(DESTDIR)$(BINDIR)
	copy /Y include\* $(DESTDIR)$(INCLUDEDIR)\libdh


uninstall:
	del $(DESTDIR)$(BINDIR)\libdh.dll
	del /Q $(DESTDIR)$(INCLUDEDIR)\libdh
	del $(DESTDIR)$(BINDIR)\datatypes.exe
	del $(DESTDIR)$(BINDIR)\quadequi.exe
	del $(DESTDIR)$(BINDIR)\portping.exe
	del $(DESTDIR)$(BINDIR)\window.exe
	del $(DESTDIR)$(BINDIR)\win-name.exe

