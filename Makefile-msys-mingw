
DESTDIR=
PREFIX=
BINDIR=$(PREFIX)/bin
LIBDIR=$(PREFIX)/lib
INCLUDEDIR=$(PREFIX)/include
SYSCONFDIR=/etc

CC=gcc
CFLAGS=-march=native -mtune=native -O3 -Wall
DEFS=

SUBDIRS=libdanh quadequi datatypes portping

all: bin out $(SUBDIRS)

.PHONY: $(SUBDIRS) clean install uninstall

bin:
	mkdir bin

out:
	mkdir out


libdanh:
	$(CC) $(CFLAGS) $(DEFS) -c libdanh/danh.c -o out/danh.o
	$(CC) $(CFLAGS) $(DEFS) -c libdanh/math.c -o out/math.o
	$(CC) $(CFLAGS) $(DEFS) -c libdanh/types.c -o out/types.o
	$(CC) -shared -Wl,-soname,libdanh.dll out/danh.o out/math.o out/types.o -o bin/libdanh.dll


quadequi:
	$(CC) $(CFLAGS) $(DEFS) quadequi/main.c -o bin/quadequi.exe -L./bin -ldanh

datatypes:
	$(CC) $(CFLAGS) $(DEFS) datatypes/main.c -o bin/datatypes.exe

portping:
	$(CC) $(CFLAGS) $(DEFS) portping/main.c -o bin/portping.exe -L./bin -ldanh -lws2_32


clean:
	rm -rf out/*
	rm -rf bin/*


install:
	mkdir -p $(DESTDIR)$(BINDIR)/
	cp -f bin/* $(DESTDIR)$(BINDIR)/
	mkdir -p $(DESTDIR)$(LIBDIR)/
	mkdir -p $(DESTDIR)$(LIBDIR)/pkgconfig/
	cp -f libdanh.pc $(DESTDIR)$(LIBDIR)/pkgconfig/libdanh.pc
	mkdir -p $(DESTDIR)$(INCLUDEDIR)/libdanh
	cp -f include/* $(DESTDIR)$(INCLUDEDIR)/libdanh/


uninstall:
	rm $(DESTDIR)$(BINDIR)/libdanh.dll
	rm $(DESTDIR)$(LIBDIR)/pkgconfig/libdanh.pc
	rm -rf $(DESTDIR)$(INCLUDEDIR)/libdanh
	rm $(DESTDIR)$(BINDIR)/datatypes.exe
	rm $(DESTDIR)$(BINDIR)/quadequi.exe
	rm $(DESTDIR)$(BINDIR)/portping.exe
